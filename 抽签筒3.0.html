<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多人抽签翻牌游戏（2-12人版）</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin-bottom: 20px;
            color: #333;
        }

        .control-panel {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .select-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        label {
            font-size: 16px;
            color: #555;
        }

        select, input {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        select {
            width: 140px; /* 加宽下拉框，适配12人选项文字 */
        }

        input {
            width: 200px;
        }

        button {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        button.reset {
            background-color: #f44336;
        }

        button.reset:hover {
            background-color: #d32f2f;
        }

        .grid-container {
            display: grid;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            position: relative;
            min-height: 120px;
        }

        .card-container {
            perspective: 1000px;
            position: absolute;
            transition: all 0.5s ease-out;
        }

        .card {
            width: 120px;
            height: 120px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 18px;
            font-weight: bold;
        }

        .card-front {
            background-color: #fff;
            color: #333;
            transform: rotateY(180deg);
        }

        .card-back {
            background-color: #2c3e50;
            color: white;
            font-size: 24px;
            border: 2px solid #34495e;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .shuffling {
            transition: none !important;
        }

        @keyframes stack {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(0.7) rotate(5deg); }
        }

        .stacked {
            animation: stack 0.8s forwards;
        }

        .info-text {
            color: #666;
            margin-top: 10px;
            font-size: 14px;
        }

        /* 适配移动端：12张牌时缩小间距，避免溢出 */
        @media (max-width: 600px) {
            .grid-container {
                gap: 10px;
            }
            .card {
                width: 100px;
                height: 100px;
            }
            .card-container {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <h1>多人抽签翻牌游戏（2-12人）</h1>
    <div class="control-panel">
        <div class="select-container">
            <label for="playerCount">选择人数：</label>
            <select id="playerCount">
                <option value="2">2人（2张牌）</option>
                <option value="3">3人（3张牌）</option>
                <option value="4">4人（4张牌）</option>
                <option value="5">5人（5张牌）</option>
                <option value="6">6人（6张牌）</option>
                <option value="7">7人（7张牌）</option>
                <option value="8">8人（8张牌）</option>
                <option value="9">9人（9张牌）</option>
                <option value="10">10人（10张牌）</option> <!-- 新增10人 -->
                <option value="11">11人（11张牌）</option> <!-- 新增11人 -->
                <option value="12">12人（12张牌）</option> <!-- 新增12人 -->
            </select>
        </div>
        <input type="text" id="cardInput" placeholder="输入牌面内容（按顺序设置）">
        <button id="setCard">设置牌面</button>
        <button id="shuffle">洗牌抽签</button>
        <button id="reset" class="reset">重置游戏</button>
    </div>
    <p class="info-text" id="infoText">提示：先设置牌面内容，再点击洗牌抽签</p>
    <div class="grid-container" id="gridContainer">
        <!-- 牌会动态生成 -->
    </div>

    <script>
        const gridContainer = document.getElementById('gridContainer');
        const cardInput = document.getElementById('cardInput');
        const setCardBtn = document.getElementById('setCard');
        const shuffleBtn = document.getElementById('shuffle');
        const resetBtn = document.getElementById('reset');
        const playerCountSelect = document.getElementById('playerCount');
        const infoText = document.getElementById('infoText');

        let cards = [];
        let currentSetIndex = 0;
        let totalCards = 9; // 默认9张牌
        let targetPositions = []; // 牌的目标位置数组

        // 优化：根据牌数智能计算布局（适配12张牌）
        function calculatePositions(count) {
            targetPositions = [];
            let cols, rows;

            // 布局规则：尽量正方形，10-12张牌用4列（避免3列太挤）
            if (count <= 4) {
                cols = 2; // 2-4张牌：2列
            } else if (count <= 9) {
                cols = 3; // 5-9张牌：3列
            } else {
                cols = 4; // 10-12张牌：4列（4列3行刚好放下12张）
            }
            rows = Math.ceil(count / cols);

            // 设置网格容器列数和间距（120px牌宽 + 15px间距）
            gridContainer.style.gridTemplateColumns = `repeat(${cols}, 120px)`;
            gridContainer.style.gridTemplateRows = `repeat(${rows}, 120px)`;

            // 计算每张牌的坐标（确保均匀排列）
            for (let i = 0; i < count; i++) {
                const row = Math.floor(i / cols);
                const col = i % cols;
                targetPositions.push({
                    x: col * 135, // 120px牌宽 + 15px间距
                    y: row * 135  // 120px牌高 + 15px间距
                });
            }
        }

        // 初始化牌（逻辑不变，适配新的人数范围）
        function initCards() {
            gridContainer.innerHTML = '';
            cards = [];
            currentSetIndex = 0;
            totalCards = parseInt(playerCountSelect.value);
            
            // 计算新布局位置
            calculatePositions(totalCards);
            
            // 创建对应数量的牌
            for (let i = 0; i < totalCards; i++) {
                const container = document.createElement('div');
                container.className = 'card-container';
                container.style.left = `${targetPositions[i].x}px`;
                container.style.top = `${targetPositions[i].y}px`;
                
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = i;

                const front = document.createElement('div');
                front.className = 'card-front';
                front.textContent = `牌${i+1}`;

                const back = document.createElement('div');
                back.className = 'card-back';
                back.textContent = '?';

                card.appendChild(front);
                card.appendChild(back);
                container.appendChild(card);
                gridContainer.appendChild(container);

                // 点击翻牌逻辑
                card.addEventListener('click', () => {
                    if (!card.classList.contains('flipped') && !card.classList.contains('shuffling')) {
                        card.classList.add('flipped');
                    }
                });

                cards.push({
                    container: container,
                    card: card,
                    front: front
                });
            }
            
            updateInfoText();
        }

        // 设置牌面内容（逻辑不变）
        function setCardContent() {
            const content = cardInput.value.trim();
            if (content && currentSetIndex < totalCards) {
                cards[currentSetIndex].front.textContent = content;
                cards[currentSetIndex].card.classList.add('flipped');
                currentSetIndex++;
                cardInput.value = '';
                updateInfoText();
            } else if (currentSetIndex >= totalCards) {
                alert(`已完成${totalCards}张牌的设置！`);
            } else {
                alert('请输入牌面内容！');
            }
        }

        // 洗牌动画（逻辑不变，适配12张牌的堆叠效果）
        function shuffleCards() {
            if (currentSetIndex < totalCards) {
                alert(`请先完成${totalCards}张牌的设置！`);
                return;
            }

            // 翻回背面
            cards.forEach(item => {
                item.card.classList.remove('flipped');
            });

            // 随机移动动画
            let shuffleInterval = setInterval(() => {
                cards.forEach(item => {
                    item.container.classList.add('shuffling');
                    const randomX = Math.floor(Math.random() * (gridContainer.offsetWidth - 120));
                    const randomY = Math.floor(Math.random() * (gridContainer.offsetHeight - 120));
                    item.container.style.left = `${randomX}px`;
                    item.container.style.top = `${randomY}px`;
                    const randomRotate = Math.floor(Math.random() * 40) - 20;
                    item.container.style.transform = `rotate(${randomRotate}deg)`;
                });
            }, 80);

            // 堆叠+散开动画
            setTimeout(() => {
                clearInterval(shuffleInterval);
                cards.forEach((item, index) => {
                    item.container.classList.remove('shuffling');
                    item.container.classList.add('stacked');
                    // 堆叠到容器中心
                    item.container.style.left = `${gridContainer.offsetWidth / 2 - 60}px`;
                    item.container.style.top = `${gridContainer.offsetHeight / 2 - 60}px`;
                    item.container.style.transform = `rotate(${5 + index * 2}deg)`;
                });

                setTimeout(() => {
                    const shuffledIndices = Array.from({length: totalCards}, (_, i) => i)
                        .sort(() => Math.random() - 0.5);

                    cards.forEach(item => {
                        item.container.classList.remove('stacked');
                        item.container.style.transform = 'rotate(0deg)';
                    });

                    // 分配到新位置
                    shuffledIndices.forEach((originalIndex, newIndex) => {
                        const target = targetPositions[newIndex];
                        const item = cards[originalIndex];
                        item.container.style.left = `${target.x}px`;
                        item.container.style.top = `${target.y}px`;
                    });

                    infoText.textContent = '洗牌完成！点击牌面查看结果';
                }, 1000);

            }, 1000);
        }

        // 更新提示文本（逻辑不变）
        function updateInfoText() {
            infoText.textContent = `已设置${currentSetIndex}/${totalCards}张牌，继续输入并点击"设置牌面"`;
        }

        // 重置游戏（逻辑不变）
        function resetGame() {
            initCards();
            cardInput.value = '';
        }

        // 事件监听（逻辑不变）
        setCardBtn.addEventListener('click', setCardContent);
        shuffleBtn.addEventListener('click', shuffleCards);
        resetBtn.addEventListener('click', resetGame);
        playerCountSelect.addEventListener('change', initCards);

        // 初始化
        initCards();
    </script>
</body>
</html>